<app-details [isHistoryDetails]="false" [uploadFileAccessGranted]="uploadFileAccessGranted"
             [removeFileAccessGranted]="removeFileAccessGranted"
             [downloadFileAccessGranted]="downloadFileAccessGranted">
  <span avatar>
    <div [ngStyle]="{'background-image': 'url('+ avatar +')', 'background-size' : 'cover'}"
         mat-card-avatar>
    </div>
  </span>
  <span title>{{primaryAttributes.number}} - {{primaryAttributes.type}}
  </span>
  <span subtitle><a
    routerLink='/projects/details/{{primaryAttributes.project?.id}}'>{{primaryAttributes.project?.name}}</a></span>
  <span content>
    <div class="row">
      <div class="col-md-8">
        <label class="attribute-label">Priority:</label> {{primaryAttributes.priority}}
        <br>
         <label class="attribute-label">Due Date:</label>
         <strong
           [ngClass]="{'dueDateExceeded': dueDateExceeded, 'dueDateComingUp': dueDateComingUp}"> {{primaryAttributes.dueDate | date: 'dd MMMM yyyy'}}</strong>
        <br>
        <br>
        <label class="attribute-label">Status: </label>
        <span *ngIf="!statusChangeOperation"> {{primaryAttributes.status}}</span>
        <span *ngIf="statusChangeOperation" style="margin-left: 10px">
          <mat-form-field>
              <mat-label>Status</mat-label>
              <mat-select (selectionChange)="changeStatus($event.value)" required>
              <mat-option *ngFor="let s of status"
                          [value]="s.internalName">{{s.displayName}}</mat-option>
            </mat-select>
          </mat-form-field>
      </span>
      </div>
      <div class="col-md-1">

      </div>
      <div class="col-md-3">
        <label class="attribute-label">Estimation:</label> {{estimationText}}
        <br>
        <label class="attribute-label">Logged:</label> {{loggedTimeText}}
        <mat-progress-bar [ngClass]='loggedTimeProgressBar > 100 ? "exceeded-estimation": "" ' mode="determinate"
                          value="{{loggedTimeProgressBar}}"></mat-progress-bar>
      </div>
    </div>

    <br>

    <div class="row">
      <div class="col-md-8">
        <label class="attribute-label">Summary:</label>
        <br>
        {{primaryAttributes.summary}}
        <br>
        <br>
        <label class="attribute-label">Description:</label>
        <br>
        {{secondaryAttributes.description}}
      </div>
      <div class="col-md-1">

      </div>
      <div class="col-md-3">
         <label
           class="attribute-label">Assignee:</label> {{primaryAttributes.assignee?.firstName}} {{primaryAttributes.assignee?.lastName}}
        <br>
         <label
           class="attribute-label">Owner:</label> {{primaryAttributes.owner?.firstName}} {{primaryAttributes.owner?.lastName}}
        <br>
        <br>
         <label
           class="attribute-label">Created By:</label> {{secondaryAttributes.createdBy?.firstName}} {{secondaryAttributes.createdBy?.lastName}}
        <br>
         <label class="attribute-label">Created:</label> {{secondaryAttributes.created | date: 'medium'}}
        <br>
         <label class="attribute-label">Modified:</label> {{secondaryAttributes.updated | date: 'medium'}}
      </div>
    </div>
    <br>
    <hr>

    <div class="row">
<!--      *ngIf="(!loadingStructure) && taskChildren.length > 0"-->
     <app-task-relation-list [taskNumber]="primaryAttributes.number" [listName]="'Structure'"></app-task-relation-list>
    </div>
  </span>

  <span buttons>
    <button mat-button matTooltip="Edit task" routerLink="/tasks/{{primaryAttributes.id}}/edit">
      <mat-icon class="details-actions">edit</mat-icon>
    </button>
    <button mat-button matTooltip="Log time" routerLink='/tasks/{{primaryAttributes.id}}/details/timelog'>
      <mat-icon class="details-actions">access_time</mat-icon>
    </button>
   <button mat-button matTooltip="Task history" routerLink="/tasks/{{primaryAttributes.id}}/history">
      <mat-icon class="details-actions">history</mat-icon>
    </button>
    <button (click)="assignTask()" *ngIf="!currentUserAssigned" mat-button matTooltip="Assign task to me">
      <mat-icon class="details-actions">assignment_returned</mat-icon>
    </button>
    <button (click)="showChangeStatusForm()" mat-button matTooltip="Change status">
      <mat-icon class="details-actions">swap_horizontal_circle</mat-icon>
    </button>
  </span>
</app-details>
